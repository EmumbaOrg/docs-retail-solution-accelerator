
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This guide serves as documentation for the deployment and configuration of Agentic Shop solution accelerator.
">
      
      
        <meta name="author" content="Azure-Samples">
      
      
        <link rel="canonical" href="https://github.com/Azure-Samples/postgres-agentic-shop/05-Agent%20Architecture%20and%20Integration/05-multiagent-class-integration/">
      
      
        <link rel="prev" href="../04-presentation-agent-prompt/">
      
      
        <link rel="next" href="../06-workflow-service-integration/">
      
      
      <link rel="icon" href="../../img/postgresql.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>5.5: MultiAgentFlow Class Integration - Agentic Shop - Guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#55-multiagentflow-class-integration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Agentic Shop - Guide" class="md-header__button md-logo" aria-label="Agentic Shop - Guide" data-md-component="logo">
      
  <img src="../../img/postgresql.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Agentic Shop - Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              5.5: MultiAgentFlow Class Integration
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="#0078D4" data-md-color-accent="#F3F2F1"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Azure-Samples/postgres-agentic-shop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Azure-Samples/postgres-agentic-shop
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Before You Begin

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../01-Introduction/" class="md-tabs__link">
          
  
  
    
  
  01 Introduction

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../02-Setup/" class="md-tabs__link">
          
  
  
    
  
  02 Setup

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../03-Setting-Up-Data-in-PostgreSQL/" class="md-tabs__link">
          
  
  
    
  
  03 Setting Up Data in PostgreSQL

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../04-Multi-Agent-Workflows/" class="md-tabs__link">
          
  
  
    
  
  04 Multi Agent Workflows

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  05 Agent Architecture and Integration

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Tear%20Down/teardown/" class="md-tabs__link">
          
  
  
    
  
  Tear Down

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Agentic Shop - Guide" class="md-nav__button md-logo" aria-label="Agentic Shop - Guide" data-md-component="logo">
      
  <img src="../../img/postgresql.svg" alt="logo">

    </a>
    Agentic Shop - Guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Azure-Samples/postgres-agentic-shop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Azure-Samples/postgres-agentic-shop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Before You Begin
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../01-Introduction/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    01 Introduction
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            01 Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-Introduction/01-App-Scenario/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.1 The App Scenario
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-Introduction/02-App-Architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2 App Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-Introduction/03-Azure-Cost/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.3 Azure Cost Estimate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-Introduction/04-Data-Structures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.4 Backend Data Structures
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../02-Setup/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    02 Setup
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            02 Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-Setup/01-Prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.1 Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-Setup/02-Development-Environment-Setup-Options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.2 Development Environment Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-Setup/03-Clone-Repo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.3 Clone the Repository
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-Setup/04-Setup-Dev-Environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.4 Setup Dev Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-Setup/05-Provision-And-Deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.5 Provision and Deploy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-Setup/06-Validate-Deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.6 Validate Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-Setup/07-Setting-Up-Env-files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.7 [OPTIONAL] Setting Up Environment (.env) Files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-Setup/08-Configure-PostgreSQL-for-VSCode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.8 [OPTIONAL] Configure PostgreSQL for VS Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-Setup/09-Run-Application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.9 [OPTIONAL] Run Application
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../03-Setting-Up-Data-in-PostgreSQL/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    03 Setting Up Data in PostgreSQL
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            03 Setting Up Data in PostgreSQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-Setting-Up-Data-in-PostgreSQL/01-Postgres-Extensions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.1 Install Extensions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-Setting-Up-Data-in-PostgreSQL/02-Alembic-Migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.2 Alembic Migrations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-Setting-Up-Data-in-PostgreSQL/03-Schema-And-Seeding-Data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.3 Creating Schema and Seeding Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-Setting-Up-Data-in-PostgreSQL/04-Generating-Memories/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.4 Generating Memories
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-Setting-Up-Data-in-PostgreSQL/05-Generating-Features-and-Sentiments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.5 Generating Features and Sentiments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-Setting-Up-Data-in-PostgreSQL/06-Building-Graphs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.6 Building Graphs for Relationship Insights
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-Setting-Up-Data-in-PostgreSQL/07-Resetting-Database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.7 Reset Database
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../04-Multi-Agent-Workflows/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    04 Multi Agent Workflows
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            04 Multi Agent Workflows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04-Multi-Agent-Workflows/01-Multi-Agent-Architecture-with-LlamaIndex-Workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1 Multi-Agent Architecture with LlamaIndex Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04-Multi-Agent-Workflows/02-Multi-Agent-Workflow-Implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.2 Multi-Agent Workflow Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04-Multi-Agent-Workflows/03-AgenticShop-Walkthrough/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.3. AgenticShop Flow Walkthrough
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04-Multi-Agent-Workflows/04-Command-Routing-Agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.4 Tool-Enabled Agent: Intelligent Query Router
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04-Multi-Agent-Workflows/05-Understanding-What-Queries-Work/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.5 🔍 Understanding What Queries Work (and Why)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    05 Agent Architecture and Integration
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            05 Agent Architecture and Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-reviews-agent-prompt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.1: Reviews Agent Prompt
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-reviews-agent-definition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.2: Reviews Agent Definition
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-planning-agent-prompt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.3 Planning Agent Prompt
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-presentation-agent-prompt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.4 Presentation Agent Prompt
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    5.5: MultiAgentFlow Class Integration
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    5.5: MultiAgentFlow Class Integration
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#understanding-multiagent-architecture-using-llamaindex-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding MultiAgent Architecture Using LlamaIndex Workflows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reviews-events" class="md-nav__link">
    <span class="md-ellipsis">
      Reviews Events
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reviews-agent-integration-in-multiagentflow-class" class="md-nav__link">
    <span class="md-ellipsis">
      Reviews Agent Integration in MultiAgentFlow Class
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-workflow-service-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.6: Workflow Service Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-agent-timeout-configuraion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.7: Agent Timeout Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-running-multi-agent-flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.8 Multi-Agent Workflow Execution
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-evaluation-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.9 Evaluation Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tear Down
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Tear Down
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tear%20Down/teardown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cleanup Resources
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#understanding-multiagent-architecture-using-llamaindex-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding MultiAgent Architecture Using LlamaIndex Workflows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reviews-events" class="md-nav__link">
    <span class="md-ellipsis">
      Reviews Events
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reviews-agent-integration-in-multiagentflow-class" class="md-nav__link">
    <span class="md-ellipsis">
      Reviews Agent Integration in MultiAgentFlow Class
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="55-multiagentflow-class-integration">5.5: MultiAgentFlow Class Integration<a class="headerlink" href="#55-multiagentflow-class-integration" title="Permanent link">&para;</a></h1>
<h2 id="understanding-multiagent-architecture-using-llamaindex-workflows">Understanding MultiAgent Architecture Using LlamaIndex Workflows<a class="headerlink" href="#understanding-multiagent-architecture-using-llamaindex-workflows" title="Permanent link">&para;</a></h2>
<p>LlamaIndex workflows are designed around an event-driven architecture. The workflow begins when a start event is triggered. Each step in the workflow is defined by a function decorated with the <code>@step</code> decorator. These step functions are activated by specific event types, which means the workflow decides which step to execute next based on the event it receives.</p>
<p>Each step processes its input event and returns a new event. This returned event determines the next step in the workflow. Steps can emit multiple events, and a single step can be set up to listen for several different event types. This flexibility allows multiple steps to run in parallel, enabling efficient and scalable workflows.</p>
<p>In the context of multi-agent systems, each step typically interacts with a different agent. By leveraging this event-driven approach, several agents can run at the same time, making the workflow both modular and highly parallelized. This structure makes it easy to add, remove, or modify agents as your application evolves.</p>
<h2 id="reviews-events">Reviews Events<a class="headerlink" href="#reviews-events" title="Permanent link">&para;</a></h2>
<p>The <code>ReviewsEvent</code> and <code>ReviewsCompletedEvent</code> classes in <code>multi_agent_workflow.py</code> handle events related to the Reviews Agent. These event classes allow the workflow to track and manage the execution and completion of the Reviews Agent.</p>
<div class="admonition info">
<p class="admonition-title"><strong>File location:</strong> <code>backend/src/agents/multi_agent_workflow.py</code> (or wherever your workflow/event classes are defined)</p>
</div>
<div class="admonition info">
<p class="admonition-title"><strong>Purpose:</strong> These classes represent the start and completion of a review agent task, enabling event-driven orchestration in your workflow.</p>
</div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ReviewsEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ReviewsCompletedEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title"><strong>What this does:</strong></p>
<p>These event classes allow the workflow to track and manage the execution and completion of the Reviews Agent.</p>
</div>
<hr />
<h2 id="reviews-agent-integration-in-multiagentflow-class">Reviews Agent Integration in MultiAgentFlow Class<a class="headerlink" href="#reviews-agent-integration-in-multiagentflow-class" title="Permanent link">&para;</a></h2>
<p>The <code>MultiAgentFlow</code> class is updated to accept the Reviews Agent, emit and handle review events, and add a step function for the Reviews Agent. This integrates the Reviews Agent into the multi-agent workflow, allowing it to be triggered, run, and its results to be handled like other agents.</p>
<div class="admonition info">
<p class="admonition-title"><strong>File location:</strong> <code>backend/src/agents/multi_agent_workflow.py</code></p>
</div>
<div class="admonition info">
<p class="admonition-title"><strong>Purpose:</strong> This integration wires the Reviews Agent into the event-driven workflow, so it can be triggered, run, and its results handled like any other agent.</p>
</div>
<p>The constructor of the MultiAgentFlow class includes the Reviews Agent:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span>
    <span class="n">product_personalization_agent</span><span class="p">:</span> <span class="n">BaseAgent</span><span class="p">,</span>
    <span class="n">inventory_agent</span><span class="p">:</span> <span class="n">BaseAgent</span><span class="p">,</span>
    <span class="n">presentation_agent</span><span class="p">:</span> <span class="n">BaseAgent</span><span class="p">,</span>
    <span class="n">planning_agent</span><span class="p">:</span> <span class="n">BaseAgent</span><span class="p">,</span>
    <span class="n">reviews_agent</span><span class="p">:</span> <span class="n">BaseAgent</span><span class="p">,</span>
    <span class="n">memory</span><span class="p">:</span> <span class="n">Memory</span><span class="p">,</span>
    <span class="n">message_queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fault_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">product_personalization_agent</span> <span class="o">=</span> <span class="n">product_personalization_agent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inventory_agent</span> <span class="o">=</span> <span class="n">inventory_agent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">presentation_agent</span> <span class="o">=</span> <span class="n">presentation_agent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">planning_agent</span> <span class="o">=</span> <span class="n">planning_agent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reviews_agent</span> <span class="o">=</span> <span class="n">reviews_agent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">memory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message_queue</span> <span class="o">=</span> <span class="n">message_queue</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fault_correction</span> <span class="o">=</span> <span class="n">fault_correction</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<p>Any type of event that a step function can emit must be mentioned in its return type. <code>ReviewsEvent</code> is included so it can be triggered by the planning agent.</p>
<p>The planning step function signature:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@step</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">planning</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span>
    <span class="n">ev</span><span class="p">:</span> <span class="n">StartEvent</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProductPersonalizationEvent</span> <span class="o">|</span> <span class="n">InventoryEvent</span> <span class="o">|</span> <span class="n">ReviewsEvent</span><span class="p">:</span>
</code></pre></div></td></tr></table></div>
<p>The planning step includes conditional logic based on the output of the planning agent. This logic determines which step to trigger next. To support the Reviews Agent, the logic can trigger the Reviews Agent when appropriate:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">if</span> <span class="s2">&quot;product_personalization&quot;</span> <span class="ow">in</span> <span class="n">agents_to_call</span><span class="p">:</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">send_event</span><span class="p">(</span><span class="n">ProductPersonalizationEvent</span><span class="p">())</span>
    <span class="n">triggered_agents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ProductPersonalizationCompletedEvent</span><span class="p">)</span>
<span class="k">if</span> <span class="s2">&quot;inventory&quot;</span> <span class="ow">in</span> <span class="n">agents_to_call</span><span class="p">:</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">send_event</span><span class="p">(</span><span class="n">InventoryEvent</span><span class="p">())</span>
    <span class="n">triggered_agents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InventoryCompletedEvent</span><span class="p">)</span>
<span class="k">if</span> <span class="s2">&quot;reviews&quot;</span> <span class="ow">in</span> <span class="n">agents_to_call</span><span class="p">:</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">send_event</span><span class="p">(</span><span class="n">ReviewsEvent</span><span class="p">())</span>
    <span class="n">triggered_agents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReviewsCompletedEvent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<p>The review agent step function is executed when the ReviewsEvent is emitted. Within this, the review agent defined in <code>agents/reviews_agent.py</code> is called:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@step</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">review</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span>
    <span class="n">ev</span><span class="p">:</span> <span class="n">ReviewsEvent</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReviewsCompletedEvent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles the review event by running the Reviews Agent and returning the result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_profile&quot;</span><span class="p">)</span>
    <span class="n">user_message</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_msg&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            Generate a summary of relevant reviews of the product based on the</span>
<span class="s2">            user&#39;s preferences: </span><span class="si">{</span><span class="n">user_info</span><span class="p">[</span><span class="s1">&#39;user_preferences&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s2">            and the optional user query: </span><span class="si">{</span><span class="n">user_message</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Review Prompt: </span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reviews_agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">prompt</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">REVIEW_AGENT_TIMEOUT</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="n">WorkflowTimeoutError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Review Agent has timed out.&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;Review agent timed out. No response&quot;</span>

    <span class="k">return</span> <span class="n">ReviewsCompletedEvent</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<hr />
<p>The presentation agent accepts the outputs of agents and then refines them before eventually passing them to the frontend. The presentation step function accepts the output of the review agent step function:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@step</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">presentation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span>
    <span class="n">ev</span><span class="p">:</span> <span class="n">ProductPersonalizationCompletedEvent</span> <span class="o">|</span> <span class="n">InventoryCompletedEvent</span> <span class="o">|</span> <span class="n">ReviewsCompletedEvent</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StopEvent</span><span class="p">:</span>
</code></pre></div></td></tr></table></div>
<hr />
<div class="admonition info">
<p class="admonition-title"><strong>What this does:</strong></p>
<p>These changes integrate the Reviews Agent into the multi-agent workflow, allowing it to be triggered, run, and its results to be handled like other agents.</p>
</div>
<hr />
<p><strong>Further Explanation:</strong></p>
<p>In this step, we explain how the Reviews Agent is integrated within the LlamaIndex workflow system. According to the <a href="https://docs.llamaindex.ai/en/stable/module_guides/workflow/#workflows">LlamaIndex Workflows documentation</a>, a workflow is an event-driven abstraction that chains together several steps, each responsible for handling specific event types and emitting new events.</p>
<p>Here's how the code in this step leverages LlamaIndex workflows:</p>
<ul>
<li>The <code>MultiAgentFlow</code> class is structured as a workflow, where each function decorated with <code>@step</code> represents a step in the workflow. Each step listens for certain event types (like <code>ReviewsEvent</code>) and produces new events (like <code>ReviewsCompletedEvent</code>).</li>
<li>By adding the Reviews Agent, we introduce a new step (<code>review</code>) that is triggered when a <code>ReviewsEvent</code> is emitted. This step processes the event, runs the Reviews Agent, and emits a <code>ReviewsCompletedEvent</code> with the result.</li>
<li>The workflow system ensures that each step only runs when the appropriate event is ready, and the input/output types are validated automatically.</li>
<li>This modular, event-driven approach allows you to flexibly chain together multiple agents and logic, making it easy to extend or modify the workflow as your application grows.</li>
</ul>
<p>In summary, this step connects the Reviews Agent to the overall multi-agent workflow, enabling event-driven, modular, and observable orchestration of agent logic using LlamaIndex's workflow system.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../04-presentation-agent-prompt/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 5.4 Presentation Agent Prompt">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                5.4 Presentation Agent Prompt
              </div>
            </div>
          </a>
        
        
          
          <a href="../06-workflow-service-integration/" class="md-footer__link md-footer__link--next" aria-label="Next: 5.6: Workflow Service Integration">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                5.6: Workflow Service Integration
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 - present Microsoft

    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.expand", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.path", "navigation.indexes", "navigation.top", "toc.follow", "navigation.footer", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
  <!-- Add scripts that need to run before here -->
  
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  <!-- Add scripts that need to run afterwards here -->

    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    

  </body>
</html>